parameters:
    # a list of supported formats of REST API requests delimited by |
    oro_api.rest.formats: json
    # default format of REST API requests
    oro_api.rest.default_format: json

services:
    oro_api.action_processor_bag:
        class: Oro\Bundle\ApiBundle\Request\ActionProcessorBag

    oro_api.processor_bag:
        class: Oro\Component\ChainProcessor\ProcessorBag
        public: false
        arguments:
            - @oro_api.processor_factory

    oro_api.processor_factory:
        class: Oro\Component\ChainProcessor\ChainProcessorFactory
        public: false
        calls:
            - [addFactory, [@oro_api.simple_processor_factory, 10]]
            - [addFactory, [@oro_api.di_processor_factory]]

    oro_api.simple_processor_factory:
        class: Oro\Component\ChainProcessor\SimpleProcessorFactory
        public: false

    oro_api.di_processor_factory:
        class: Oro\Component\ChainProcessor\DependencyInjection\ProcessorFactory
        public: false
        arguments:
            - @service_container

    oro_api.value_normalizer:
        class: Oro\Bundle\ApiBundle\Request\ValueNormalizer
        public: false
        arguments:
            - @oro_api.normalize_value.processor

    oro_api.item_normalizer:
        class: Oro\Bundle\ApiBundle\Normalizer\ItemNormalizer
        public: false
        arguments:
            - @oro_entity.doctrine_helper
            - @oro_api.entity_accessor
        calls:
            - [addNormalizer, [@oro_api.search_item_normalizer, 50]]
            - [addNormalizer, [@oro_api.datetime_normalizer]]

    oro_api.datetime_normalizer:
        class: Oro\Bundle\ApiBundle\Normalizer\DateTimeNormalizer
        public: false

    oro_api.search_item_normalizer:
        class: Oro\Bundle\ApiBundle\Normalizer\SearchItemNormalizer
        public: false

    oro_api.config_bag:
        class: Oro\Bundle\ApiBundle\Provider\ConfigBag
        public: false
        arguments:
            - []

    oro_api.config_provider:
        class: Oro\Bundle\ApiBundle\Provider\ConfigProvider
        public: false
        arguments:
            - @oro_api.get_config.processor

    oro_api.entity_exclusion_provider:
        class: Oro\Bundle\EntityBundle\Provider\ChainExclusionProvider
        public: false
        calls:
            - [addProvider, [ @oro_entity.exclusion_provider.config ] ]

    oro_api.entity_serializer:
        class: Oro\Component\EntitySerializer\EntitySerializer
        public: false
        arguments:
            - @doctrine
            - @oro_api.entity_field_filter
            - @oro_api.entity_accessor
            - @oro_api.entity_data_transformer
            - @oro_entity.query_hint_resolver

    oro_api.entity_field_filter:
        class: Oro\Bundle\EntityExtendBundle\Serializer\ExtendEntityFieldFilter
        public: false
        arguments:
            - @oro_entity_config.config_manager

    oro_api.entity_accessor:
        class: Oro\Component\EntitySerializer\EntityDataAccessor
        public: false

    oro_api.entity_data_transformer:
        class: Oro\Component\EntitySerializer\EntityDataTransformer
        public: false
        arguments:
            - @service_container

    oro_api.rest_api_routing_options_resolver:
        class: Oro\Bundle\ApiBundle\Routing\RestApiRouteOptionsResolver
        public: false
        arguments:
            - @oro_entity_config.entity_manager_bag
            - @oro_api.entity_exclusion_provider
            - @oro_entity.entity_alias_resolver
            - @oro_entity.doctrine_helper
            - @oro_api.value_normalizer
            - %oro_api.rest.formats%
            - %oro_api.rest.default_format%
        tags:
            - { name: routing.options_resolver, priority: -255 }

    oro_api.rest_api_doc_handler:
        class: Oro\Bundle\ApiBundle\Routing\RestApiDocHandler
        public: false
        arguments:
            - @oro_api.action_processor_bag
            - @oro_entity.entity_class_name_provider
            - @oro_entity.entity_alias_resolver
            - @oro_entity.doctrine_helper
            - @oro_api.value_normalizer
        tags:
            - { name: nelmio_api_doc.extractor.handler }
